---
// Installation guide component
import { getLangFromUrl, useTranslations } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<section id="installation" class="installation-section compact-section">
  <div class="container">
    <h2 class="section-title">{t('installation.title')}</h2>
    <p class="section-subtitle">{t('installation.subtitle')}</p>

    <div class="install-steps">
      <div class="step">
        <div class="step-number">1</div>
        <div class="step-content">
          <h3>{t('installation.step1.title')}</h3>
          <p>{t('installation.step1.description')}</p>
        </div>
      </div>

      <div class="step">
        <div class="step-number">2</div>
        <div class="step-content">
          <h3>{t('installation.step2.title')}</h3>
          <div class="platform-tabs">
            <details>
              <summary><strong>ü™ü Windows</strong></summary>
              <p class="warning"><strong>{t('installation.step2.windows.prereq')}</strong> {t('installation.step2.windows.prereq.text')} <a href="https://aka.ms/vs/17/release/vc_redist.x64.exe" target="_blank" style="color: #A5B4FC;">{t('installation.step2.windows.prereq.link')}</a> {t('installation.step2.windows.prereq.note')}</p>
              <ol>
                <li>{t('installation.step2.windows.step1')}</li>
                <li>{t('installation.step2.windows.step2')}</li>
                <li>{t('installation.step2.windows.step3')}</li>
                <li>{t('installation.step2.windows.step4')}</li>
                <li>{t('installation.step2.windows.step5')}</li>
              </ol>
              <p class="note">{t('installation.step2.windows.note')}</p>
            </details>

            <details>
              <summary><strong>üçé macOS (Apple Silicon)</strong></summary>
              <ol>
                <li>{t('installation.step2.macos.step1')}</li>
                <li>{t('installation.step2.macos.step2')}</li>
                <li><strong>{t('installation.step2.macos.step3')}</strong></li>
                <li>{t('installation.step2.macos.step4')}</li>
              </ol>
              <p class="warning"><strong>{t('installation.step2.macos.quarantine.warning')}</strong></p>
              <p>{t('installation.step2.macos.quarantine.text1')}</p>
              <pre><code>sudo xattr -rd com.apple.quarantine /Applications/Zigy.app</code></pre>
              <p>{t('installation.step2.macos.quarantine.text2')}</p>
              <p class="note">{t('installation.step2.macos.note')}</p>
            </details>

            <details>
              <summary><strong>üêß Linux (Ubuntu/Debian)</strong></summary>
              <pre><code>sudo dpkg -i zigy_0.1.0_amd64.deb</code></pre>
              <p>{t('installation.step2.linux.debian.text')}</p>
            </details>

            <details>
              <summary><strong>üêß Linux (AppImage)</strong></summary>
              <pre><code>chmod +x zigy_0.1.0_amd64.AppImage
./zigy_0.1.0_amd64.AppImage</code></pre>
              <p class="note">{t('installation.step2.linux.appimage.note')}</p>
            </details>

            <details>
              <summary><strong>üêß Linux (Arch Linux)</strong></summary>
              <p><strong>{t('installation.step2.linux.arch.option1')}</strong></p>
              <pre><code>chmod +x zigy_0.1.0_amd64.AppImage
./zigy_0.1.0_amd64.AppImage</code></pre>

              <p><strong>{t('installation.step2.linux.arch.option2')}</strong></p>
              <p>{t('installation.step2.linux.arch.option2.text')}</p>
              <pre><code>./zigy_0.1.0_amd64.AppImage --appimage-extract
./squashfs-root/zig-april-captions-ui</code></pre>

              <p><strong>{t('installation.step2.linux.arch.option3')}</strong></p>
              <pre><code>yay -S zigy</code></pre>
              <p class="note">{t('installation.step2.linux.arch.note')}</p>
            </details>
          </div>
        </div>
      </div>

      <div class="step">
        <div class="step-number">3</div>
        <div class="step-content">
          <h3>{t('installation.step3.title')}</h3>
          <p>{t('installation.step3.description')}</p>
          <a href="https://abb128.github.io/april-asr/models.html" target="_blank" class="model-link">
            {t('installation.step3.link')}
          </a>
          <p class="note">{t('installation.step3.note')}</p>
        </div>
      </div>

      <div class="step">
        <div class="step-number">4</div>
        <div class="step-content">
          <h3>{t('installation.step4.title')}</h3>
          <ol>
            <li>{t('installation.step4.step1')}</li>
            <li>{t('installation.step4.step2')}</li>
            <li>{t('installation.step4.step3')}</li>
            <li>{t('installation.step4.step4')}</li>
            <li>{t('installation.step4.step5')}</li>
          </ol>
        </div>
      </div>

      <div class="step">
        <div class="step-number">5</div>
        <div class="step-content">
          <h3>{t('installation.step5.title')}</h3>
          <p>{t('installation.step5.description')}</p>
          <div class="feature-highlights">
            <span>{t('installation.step5.feature1')}</span>
            <span>{t('installation.step5.feature2')}</span>
            <span>{t('installation.step5.feature3')}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="help-section">
      <h3>{t('installation.help.title')}</h3>
      <p>{t('installation.help.description')} <a href="https://github.com/minhtranin/zigy#-installation-guide-for-everyone" target="_blank">{t('installation.help.github')}</a> {t('installation.help.or')} <a href="https://github.com/minhtranin/zigy/issues" target="_blank">{t('installation.help.report')}</a>.</p>
    </div>

    <div class="troubleshooting-section">
      <h3>{t('installation.troubleshooting.title')}</h3>

      <div class="troubleshooting-item">
        <h4>{t('installation.troubleshooting.dll.title')}</h4>
        <p>{t('installation.troubleshooting.dll.description')} <a href="https://aka.ms/vs/17/release/vc_redist.x64.exe" target="_blank">{t('installation.troubleshooting.dll.link')}</a> {t('installation.troubleshooting.dll.note')}</p>
      </div>

      <div class="troubleshooting-item">
        <h4>{t('installation.troubleshooting.gio.title')}</h4>
        <p>{t('installation.troubleshooting.gio.description')}</p>
      </div>

      <div class="troubleshooting-item">
        <h4>{t('installation.troubleshooting.speech.title')}</h4>
        <ul>
          <li>{t('installation.troubleshooting.speech.step1')}</li>
          <li>{t('installation.troubleshooting.speech.step2')}</li>
          <li>{t('installation.troubleshooting.speech.step3')}</li>
        </ul>
      </div>

      <div class="troubleshooting-item">
        <h4>{t('installation.troubleshooting.crash.title')}</h4>
        <ul>
          <li>{t('installation.troubleshooting.crash.step1')}</li>
          <li>{t('installation.troubleshooting.crash.step2')}</li>
          <li>{t('installation.troubleshooting.crash.step3')}</li>
        </ul>
      </div>

      <div class="troubleshooting-item">
        <h4>{t('installation.troubleshooting.windows.mic.title')}</h4>
        <p>{t('installation.troubleshooting.windows.mic.description')}</p>
        <ol>
          <li>{t('installation.troubleshooting.windows.mic.step1')}</li>
          <li>{t('installation.troubleshooting.windows.mic.step2')}</li>
          <li>{t('installation.troubleshooting.windows.mic.step3')}</li>
          <li>{t('installation.troubleshooting.windows.mic.step4')}</li>
        </ol>
      </div>

      <div class="troubleshooting-item">
        <h4>{t('installation.troubleshooting.windows.audio.title')}</h4>
        <ol>
          <li>{t('installation.troubleshooting.windows.audio.step1')}</li>
          <li>{t('installation.troubleshooting.windows.audio.step2')}</li>
          <li>{t('installation.troubleshooting.windows.audio.step3')}</li>
        </ol>
      </div>
    </div>
  </div>
</section>

<style>
  .installation-section {
    background: #111827;
    color: #F9FAFB;
    position: relative;
  }

  .section-title {
    text-align: center;
    font-size: 1.35rem;
    font-weight: 700;
    margin-bottom: 0.4rem;
    color: #F9FAFB;
    letter-spacing: -0.02em;
  }

  .section-subtitle {
    text-align: center;
    font-size: 0.9rem;
    color: #9CA3AF;
    margin-bottom: 1.5rem;
    line-height: 1.4;
  }

  .install-steps {
    max-width: 750px;
    margin: 0 auto;
  }

  .step {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.25rem;
  }

  .step-number {
    flex-shrink: 0;
    width: 34px;
    height: 34px;
    background: linear-gradient(135deg, #6C5CE7 0%, #8B5CF6 100%);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(108, 92, 231, 0.4);
  }

  .step-content {
    flex: 1;
  }

  .step-content h3 {
    font-size: 1rem;
    margin-bottom: 0.4rem;
    color: #F9FAFB;
    font-weight: 600;
    letter-spacing: -0.01em;
  }

  .step-content p {
    color: #9CA3AF;
    margin-bottom: 0.6rem;
    font-size: 0.85rem;
    line-height: 1.4;
  }

  .platform-tabs details {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    padding: 0.9rem;
    border-radius: 12px;
    margin-bottom: 0.4rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    transition: all 0.2s ease;
  }

  .platform-tabs details:hover {
    border-color: rgba(139, 92, 246, 0.4);
    background: rgba(139, 92, 246, 0.08);
  }

  .platform-tabs summary {
    cursor: pointer;
    padding: 0.4rem;
    user-select: none;
    font-size: 0.9rem;
    font-weight: 500;
    color: #E0E7FF;
  }

  .platform-tabs summary:hover {
    background: rgba(108, 92, 231, 0.15);
    border-radius: 6px;
  }

  .platform-tabs ol {
    margin-left: 1.25rem;
    margin-top: 0.75rem;
  }

  .platform-tabs li {
    margin-bottom: 0.4rem;
    color: #9CA3AF;
    font-size: 0.85rem;
  }

  .step-content ol {
    margin-left: 0;
    margin-top: 0.75rem;
    padding-left: 1.5rem;
  }

  .step-content li {
    margin-bottom: 0.4rem;
    color: #9CA3AF;
    font-size: 0.85rem;
    line-height: 1.4;
  }

  code, pre {
    background: #1F2937;
    color: #F9FAFB;
    padding: 0.2rem 0.4rem;
    border-radius: 6px;
    font-family: 'Courier New', monospace;
    font-size: 0.82rem;
  }

  pre {
    padding: 0.9rem;
    overflow-x: auto;
    margin: 0.75rem 0;
    border-radius: 10px;
    border: 1px solid rgba(55, 65, 81, 0.8);
  }

  pre code {
    background: none;
    padding: 0;
  }

  .note {
    font-size: 0.8rem;
    color: #6B7280;
    font-style: italic;
    margin-top: 0.4rem;
  }

  .warning {
    font-size: 0.85rem;
    color: #FCD34D;
    background: rgba(252, 211, 77, 0.1);
    border: 1px solid rgba(252, 211, 77, 0.3);
    padding: 0.6rem 0.9rem;
    border-radius: 8px;
    margin-bottom: 0.6rem;
  }

  .warning strong {
    color: #FBBF24;
  }

  .warning a {
    color: #A5B4FC;
    text-decoration: underline;
  }

  .warning a:hover {
    color: #C4B5FD;
  }

  .model-link {
    display: inline-block;
    padding: 0.65rem 1.35rem;
    background: linear-gradient(135deg, #6C5CE7 0%, #8B5CF6 100%);
    color: white;
    text-decoration: none;
    border-radius: 999px;
    margin: 0.75rem 0;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    font-size: 0.85rem;
    font-weight: 500;
    box-shadow: 0 4px 14px rgba(108, 92, 231, 0.4);
  }

  .model-link:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(108, 92, 231, 0.5);
  }

  .feature-highlights {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin-top: 0.75rem;
  }

  .feature-highlights span {
    background: rgba(139, 92, 246, 0.2);
    color: #C4B5FD;
    padding: 0.3rem 0.7rem;
    border-radius: 999px;
    font-size: 0.75rem;
    font-weight: 500;
    border: 1px solid rgba(139, 92, 246, 0.3);
  }

  .help-section {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    padding: 1.35rem;
    border-radius: 14px;
    text-align: center;
    margin-top: 2rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .help-section h3 {
    margin-bottom: 0.5rem;
    color: #F9FAFB;
    font-weight: 600;
    font-size: 1rem;
  }

  .help-section p {
    font-size: 0.85rem;
    color: #9CA3AF;
  }

  .help-section a {
    color: #A5B4FC;
    text-decoration: none;
    font-weight: 500;
    transition: color 0.2s ease;
  }

  .help-section a:hover {
    color: #C4B5FD;
    text-decoration: underline;
  }

  .troubleshooting-section {
    background: rgba(255, 255, 255, 0.03);
    backdrop-filter: blur(10px);
    padding: 1.5rem;
    border-radius: 14px;
    margin-top: 1.5rem;
    border: 1px solid rgba(255, 255, 255, 0.08);
  }

  .troubleshooting-section h3 {
    color: #F9FAFB;
    font-weight: 600;
    font-size: 1.1rem;
    margin-bottom: 1rem;
    text-align: center;
  }

  .troubleshooting-item {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    padding: 0.9rem 1.1rem;
    margin-bottom: 0.75rem;
    transition: all 0.2s ease;
  }

  .troubleshooting-item:hover {
    background: rgba(255, 255, 255, 0.04);
    border-color: rgba(139, 92, 246, 0.2);
  }

  .troubleshooting-item h4 {
    color: #E0E7FF;
    font-size: 0.9rem;
    font-weight: 600;
    margin-bottom: 0.4rem;
    letter-spacing: -0.01em;
  }

  .troubleshooting-item p {
    color: #9CA3AF;
    font-size: 0.85rem;
    line-height: 1.4;
    margin-bottom: 0;
  }

  .troubleshooting-item ul,
  .troubleshooting-item ol {
    margin: 0.4rem 0 0;
    padding-left: 1.25rem;
  }

  .troubleshooting-item li {
    color: #9CA3AF;
    font-size: 0.85rem;
    line-height: 1.4;
    margin-bottom: 0.25rem;
  }

  .troubleshooting-item a {
    color: #A5B4FC;
    text-decoration: none;
    font-weight: 500;
  }

  .troubleshooting-item a:hover {
    color: #C4B5FD;
    text-decoration: underline;
  }

  @media (max-width: 768px) {
    .step {
      flex-direction: column;
      gap: 0.6rem;
      margin-bottom: 1rem;
    }

    .step-number {
      width: 30px;
      height: 30px;
      font-size: 0.9rem;
    }

    .help-section {
      margin-top: 1.5rem;
      padding: 1.1rem;
    }
  }
</style>
